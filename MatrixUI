--// MatrixUI Rayfield-Inspired Edition v2
--// Enhanced visual design with modern animations

local MatrixUI = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

--// Modern Theme
local Theme = {
	Background = Color3.fromRGB(15, 15, 20),
	Surface = Color3.fromRGB(20, 20, 28),
	Elevated = Color3.fromRGB(25, 25, 35),
	Primary = Color3.fromRGB(100, 120, 255),
	PrimaryHover = Color3.fromRGB(120, 140, 255),
	Success = Color3.fromRGB(80, 200, 120),
	Error = Color3.fromRGB(240, 80, 80),
	Warning = Color3.fromRGB(255, 180, 70),
	Text = Color3.fromRGB(240, 240, 250),
	TextSecondary = Color3.fromRGB(160, 160, 180),
	TextMuted = Color3.fromRGB(100, 100, 120),
	Border = Color3.fromRGB(40, 40, 55),
	Shadow = Color3.fromRGB(0, 0, 0),
	Accent = Color3.fromRGB(100, 120, 255),
	Font = Enum.Font.GothamMedium,
	FontBold = Enum.Font.GothamBold
}

--// Utility Functions
local function Create(className, properties, children)
	local instance = Instance.new(className)
	for k, v in pairs(properties or {}) do
		instance[k] = v
	end
	for _, child in pairs(children or {}) do
		child.Parent = instance
	end
	return instance
end

local function Tween(instance, properties, duration, style, direction)
	TweenService:Create(
		instance,
		TweenInfo.new(duration or 0.3, style or Enum.EasingStyle.Quart, direction or Enum.EasingDirection.Out),
		properties
	):Play()
end

local function AddCorner(parent, radius)
	Create("UICorner", {
		Parent = parent,
		CornerRadius = radius or UDim.new(0, 10)
	})
end

local function AddStroke(parent, color, thickness)
	Create("UIStroke", {
		Parent = parent,
		Color = color or Theme.Border,
		Thickness = thickness or 1,
		ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
		Transparency = 0.5
	})
end

local function AddShadow(parent, transparency)
	Create("ImageLabel", {
		Parent = parent,
		BackgroundTransparency = 1,
		Image = "rbxassetid://6014261993",
		ImageColor3 = Theme.Shadow,
		ImageTransparency = transparency or 0.8,
		Size = UDim2.new(1, 30, 1, 30),
		Position = UDim2.new(0, -15, 0, -15),
		ZIndex = parent.ZIndex - 1
	})
end

local function AddPadding(parent, all)
	Create("UIPadding", {
		Parent = parent,
		PaddingLeft = UDim.new(0, all or 12),
		PaddingRight = UDim.new(0, all or 12),
		PaddingTop = UDim.new(0, all or 12),
		PaddingBottom = UDim.new(0, all or 12)
	})
end

--// Window Creation
function MatrixUI:CreateWindow(config)
	config = config or {}
	local Title = config.Title or "MatrixUI"
	local Subtitle = config.Subtitle or "Rayfield Inspired"
	local Size = config.Size or UDim2.new(0, 580, 0, 460)

	if game.CoreGui:FindFirstChild("MatrixUI") then
		game.CoreGui.MatrixUI:Destroy()
	end

	local ScreenGui = Create("ScreenGui", {
		Name = "MatrixUI",
		Parent = game.CoreGui,
		ResetOnSpawn = false,
		ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	})

	local Main = Create("Frame", {
		Parent = ScreenGui,
		BackgroundColor3 = Theme.Background,
		Size = Size,
		Position = UDim2.new(0.5, -Size.X.Offset/2, 0.5, -Size.Y.Offset/2),
		ClipsDescendants = false,
		ZIndex = 1
	})
	AddCorner(Main, UDim.new(0, 14))
	AddStroke(Main, Theme.Border, 1)
	AddShadow(Main, 0.7)

	--// Header
	local Header = Create("Frame", {
		Parent = Main,
		BackgroundColor3 = Theme.Surface,
		Size = UDim2.new(1, 0, 0, 60),
		ZIndex = 2
	})
	AddCorner(Header, UDim.new(0, 14))

	local HeaderClip = Create("Frame", {
		Parent = Header,
		BackgroundColor3 = Theme.Surface,
		Size = UDim2.new(1, 0, 0.5, 0),
		Position = UDim2.new(0, 0, 0.5, 0),
		BorderSizePixel = 0,
		ZIndex = 2
	})

	local AccentBar = Create("Frame", {
		Parent = Header,
		BackgroundColor3 = Theme.Primary,
		Size = UDim2.new(1, 0, 0, 2),
		Position = UDim2.new(0, 0, 1, -2),
		BorderSizePixel = 0,
		ZIndex = 3
	})

	local TitleLabel = Create("TextLabel", {
		Parent = Header,
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 20, 0, 12),
		Size = UDim2.new(1, -40, 0, 22),
		Text = Title,
		Font = Theme.FontBold,
		TextSize = 18,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextColor3 = Theme.Text,
		ZIndex = 3
	})

	local SubtitleLabel = Create("TextLabel", {
		Parent = Header,
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 20, 0, 36),
		Size = UDim2.new(1, -40, 0, 16),
		Text = Subtitle,
		Font = Theme.Font,
		TextSize = 13,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextColor3 = Theme.TextSecondary,
		ZIndex = 3
	})

	--// Navigation Panel
	local NavPanel = Create("Frame", {
		Parent = Main,
		BackgroundColor3 = Theme.Surface,
		Position = UDim2.new(0, 0, 0, 60),
		Size = UDim2.new(0, 160, 1, -60),
		BorderSizePixel = 0,
		ZIndex = 2
	})
	
	local NavPadding = Create("UIPadding", {
		Parent = NavPanel,
		PaddingTop = UDim.new(0, 15),
		PaddingLeft = UDim.new(0, 10),
		PaddingRight = UDim.new(0, 10),
		PaddingBottom = UDim.new(0, 15)
	})

	local TabList = Create("UIListLayout", {
		Parent = NavPanel,
		Padding = UDim.new(0, 6),
		SortOrder = Enum.SortOrder.LayoutOrder
	})

	--// Content Area
	local ContentArea = Create("Frame", {
		Parent = Main,
		BackgroundColor3 = Theme.Background,
		Position = UDim2.new(0, 160, 0, 60),
		Size = UDim2.new(1, -160, 1, -60),
		BorderSizePixel = 0,
		ClipsDescendants = true,
		ZIndex = 1
	})

	local ContentPadding = Create("UIPadding", {
		Parent = ContentArea,
		PaddingTop = UDim.new(0, 15),
		PaddingLeft = UDim.new(0, 15),
		PaddingRight = UDim.new(0, 10),
		PaddingBottom = UDim.new(0, 15)
	})

	local Window = {}
	local ActiveTab = nil

	--// Tab Creation
	function Window:CreateTab(tabName, icon)
		local Tab = {}
		local TabButton = Create("TextButton", {
			Parent = NavPanel,
			BackgroundColor3 = Theme.Elevated,
			BackgroundTransparency = 1,
			Size = UDim2.new(1, 0, 0, 38),
			Font = Theme.Font,
			Text = "  " .. tabName,
			TextSize = 14,
			TextXAlignment = Enum.TextXAlignment.Left,
			TextColor3 = Theme.TextMuted,
			AutoButtonColor = false,
			ZIndex = 3
		})
		AddCorner(TabButton, UDim.new(0, 8))

		local Indicator = Create("Frame", {
			Parent = TabButton,
			BackgroundColor3 = Theme.Primary,
			Size = UDim2.new(0, 3, 0.7, 0),
			Position = UDim2.new(0, 0, 0.15, 0),
			BorderSizePixel = 0,
			BackgroundTransparency = 1,
			ZIndex = 4
		})
		AddCorner(Indicator, UDim.new(1, 0))

		local TabPage = Create("ScrollingFrame", {
			Parent = ContentArea,
			BackgroundTransparency = 1,
			Size = UDim2.new(1, 0, 1, 0),
			ScrollBarThickness = 4,
			ScrollBarImageColor3 = Theme.Primary,
			BorderSizePixel = 0,
			AutomaticCanvasSize = Enum.AutomaticSize.Y,
			CanvasSize = UDim2.new(0, 0, 0, 0),
			Visible = false,
			ZIndex = 2
		})

		local PageList = Create("UIListLayout", {
			Parent = TabPage,
			Padding = UDim.new(0, 12),
			SortOrder = Enum.SortOrder.LayoutOrder
		})

		local function SelectTab()
			if ActiveTab then
				Tween(ActiveTab.Button, {BackgroundTransparency = 1, TextColor3 = Theme.TextMuted})
				Tween(ActiveTab.Indicator, {BackgroundTransparency = 1})
				ActiveTab.Page.Visible = false
			end

			ActiveTab = {Button = TabButton, Page = TabPage, Indicator = Indicator}
			TabPage.Visible = true
			Tween(TabButton, {BackgroundTransparency = 0, TextColor3 = Theme.Text})
			Tween(Indicator, {BackgroundTransparency = 0})
		end

		TabButton.MouseEnter:Connect(function()
			if ActiveTab and ActiveTab.Button ~= TabButton then
				Tween(TabButton, {BackgroundTransparency = 0.5})
			end
		end)

		TabButton.MouseLeave:Connect(function()
			if ActiveTab and ActiveTab.Button ~= TabButton then
				Tween(TabButton, {BackgroundTransparency = 1})
			end
		end)

		TabButton.MouseButton1Click:Connect(SelectTab)

		if not ActiveTab then
			SelectTab()
		end

		--// Section Creation
		function Tab:CreateSection(sectionName)
			local Section = {}

			local SectionFrame = Create("Frame", {
				Parent = TabPage,
				BackgroundColor3 = Theme.Surface,
				Size = UDim2.new(1, -5, 0, 0),
				AutomaticSize = Enum.AutomaticSize.Y,
				ZIndex = 2
			})
			AddCorner(SectionFrame, UDim.new(0, 10))
			AddStroke(SectionFrame, Theme.Border, 1)

			local SectionHeader = Create("TextLabel", {
				Parent = SectionFrame,
				BackgroundTransparency = 1,
				Position = UDim2.new(0, 14, 0, 10),
				Size = UDim2.new(1, -28, 0, 20),
				Text = sectionName,
				Font = Theme.FontBold,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Left,
				TextColor3 = Theme.Primary,
				ZIndex = 3
			})

			local Divider = Create("Frame", {
				Parent = SectionFrame,
				BackgroundColor3 = Theme.Border,
				Position = UDim2.new(0, 14, 0, 35),
				Size = UDim2.new(1, -28, 0, 1),
				BorderSizePixel = 0,
				ZIndex = 3
			})

			local ElementsContainer = Create("Frame", {
				Parent = SectionFrame,
				BackgroundTransparency = 1,
				Position = UDim2.new(0, 0, 0, 45),
				Size = UDim2.new(1, 0, 0, 0),
				AutomaticSize = Enum.AutomaticSize.Y,
				ZIndex = 2
			})

			local ElementsList = Create("UIListLayout", {
				Parent = ElementsContainer,
				Padding = UDim.new(0, 8),
				SortOrder = Enum.SortOrder.LayoutOrder
			})

			local ElementsPadding = Create("UIPadding", {
				Parent = ElementsContainer,
				PaddingLeft = UDim.new(0, 14),
				PaddingRight = UDim.new(0, 14),
				PaddingBottom = UDim.new(0, 12)
			})

			--// Button Element
			function Section:CreateButton(buttonConfig)
				local ButtonName = buttonConfig.Name or "Button"
				local Callback = buttonConfig.Callback or function() end

				local ButtonFrame = Create("TextButton", {
					Parent = ElementsContainer,
					BackgroundColor3 = Theme.Elevated,
					Size = UDim2.new(1, 0, 0, 36),
					Font = Theme.Font,
					Text = "",
					AutoButtonColor = false,
					ZIndex = 3
				})
				AddCorner(ButtonFrame, UDim.new(0, 8))

				local ButtonLabel = Create("TextLabel", {
					Parent = ButtonFrame,
					BackgroundTransparency = 1,
					Position = UDim2.new(0, 12, 0, 0),
					Size = UDim2.new(1, -24, 1, 0),
					Text = ButtonName,
					Font = Theme.Font,
					TextSize = 13,
					TextXAlignment = Enum.TextXAlignment.Left,
					TextColor3 = Theme.Text,
					ZIndex = 4
				})

				ButtonFrame.MouseEnter:Connect(function()
					Tween(ButtonFrame, {BackgroundColor3 = Theme.Primary})
				end)

				ButtonFrame.MouseLeave:Connect(function()
					Tween(ButtonFrame, {BackgroundColor3 = Theme.Elevated})
				end)

				ButtonFrame.MouseButton1Click:Connect(function()
					Tween(ButtonFrame, {BackgroundColor3 = Theme.PrimaryHover}, 0.1)
					wait(0.1)
					Tween(ButtonFrame, {BackgroundColor3 = Theme.Primary}, 0.1)
					Callback()
				end)

				return ButtonFrame
			end

			--// Toggle Element
			function Section:CreateToggle(toggleConfig)
				local ToggleName = toggleConfig.Name or "Toggle"
				local CurrentValue = toggleConfig.CurrentValue or false
				local Callback = toggleConfig.Callback or function() end

				local ToggleFrame = Create("Frame", {
					Parent = ElementsContainer,
					BackgroundTransparency = 1,
					Size = UDim2.new(1, 0, 0, 36),
					ZIndex = 3
				})

				local ToggleLabel = Create("TextLabel", {
					Parent = ToggleFrame,
					BackgroundTransparency = 1,
					Size = UDim2.new(1, -50, 1, 0),
					Text = ToggleName,
					Font = Theme.Font,
					TextSize = 13,
					TextXAlignment = Enum.TextXAlignment.Left,
					TextColor3 = Theme.Text,
					ZIndex = 4
				})

				local ToggleButton = Create("TextButton", {
					Parent = ToggleFrame,
					BackgroundColor3 = CurrentValue and Theme.Primary or Theme.Elevated,
					Position = UDim2.new(1, -42, 0.5, -10),
					Size = UDim2.new(0, 42, 0, 20),
					Text = "",
					AutoButtonColor = false,
					ZIndex = 4
				})
				AddCorner(ToggleButton, UDim.new(1, 0))

				local ToggleIndicator = Create("Frame", {
					Parent = ToggleButton,
					BackgroundColor3 = Theme.Text,
					Position = CurrentValue and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8),
					Size = UDim2.new(0, 16, 0, 16),
					ZIndex = 5
				})
				AddCorner(ToggleIndicator, UDim.new(1, 0))

				ToggleButton.MouseButton1Click:Connect(function()
					CurrentValue = not CurrentValue
					Tween(ToggleButton, {BackgroundColor3 = CurrentValue and Theme.Primary or Theme.Elevated})
					Tween(ToggleIndicator, {Position = CurrentValue and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)})
					Callback(CurrentValue)
				end)

				return ToggleFrame
			end

			--// Slider Element
			function Section:CreateSlider(sliderConfig)
				local SliderName = sliderConfig.Name or "Slider"
				local Min = sliderConfig.Min or 0
				local Max = sliderConfig.Max or 100
				local CurrentValue = sliderConfig.CurrentValue or Min
				local Callback = sliderConfig.Callback or function() end

				local SliderFrame = Create("Frame", {
					Parent = ElementsContainer,
					BackgroundTransparency = 1,
					Size = UDim2.new(1, 0, 0, 50),
					ZIndex = 3
				})

				local SliderLabel = Create("TextLabel", {
					Parent = SliderFrame,
					BackgroundTransparency = 1,
					Size = UDim2.new(1, -60, 0, 20),
					Text = SliderName,
					Font = Theme.Font,
					TextSize = 13,
					TextXAlignment = Enum.TextXAlignment.Left,
					TextColor3 = Theme.Text,
					ZIndex = 4
				})

				local ValueLabel = Create("TextLabel", {
					Parent = SliderFrame,
					BackgroundTransparency = 1,
					Position = UDim2.new(1, -55, 0, 0),
					Size = UDim2.new(0, 55, 0, 20),
					Text = tostring(CurrentValue),
					Font = Theme.FontBold,
					TextSize = 13,
					TextXAlignment = Enum.TextXAlignment.Right,
					TextColor3 = Theme.Primary,
					ZIndex = 4
				})

				local SliderBack = Create("Frame", {
					Parent = SliderFrame,
					BackgroundColor3 = Theme.Elevated,
					Position = UDim2.new(0, 0, 0, 28),
					Size = UDim2.new(1, 0, 0, 6),
					ZIndex = 4
				})
				AddCorner(SliderBack, UDim.new(1, 0))

				local SliderFill = Create("Frame", {
					Parent = SliderBack,
					BackgroundColor3 = Theme.Primary,
					Size = UDim2.new((CurrentValue - Min) / (Max - Min), 0, 1, 0),
					ZIndex = 5
				})
				AddCorner(SliderFill, UDim.new(1, 0))

				local SliderButton = Create("TextButton", {
					Parent = SliderBack,
					BackgroundColor3 = Theme.Text,
					Position = UDim2.new((CurrentValue - Min) / (Max - Min), -6, 0.5, -6),
					Size = UDim2.new(0, 12, 0, 12),
					Text = "",
					AutoButtonColor = false,
					ZIndex = 6
				})
				AddCorner(SliderButton, UDim.new(1, 0))

				local dragging = false

				SliderButton.MouseButton1Down:Connect(function()
					dragging = true
				end)

				UserInputService.InputEnded:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 then
						dragging = false
					end
				end)

				UserInputService.InputChanged:Connect(function(input)
					if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
						local pos = math.clamp((input.Position.X - SliderBack.AbsolutePosition.X) / SliderBack.AbsoluteSize.X, 0, 1)
						CurrentValue = math.floor(Min + (Max - Min) * pos)
						ValueLabel.Text = tostring(CurrentValue)
						Tween(SliderFill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.1)
						Tween(SliderButton, {Position = UDim2.new(pos, -6, 0.5, -6)}, 0.1)
						Callback(CurrentValue)
					end
				end)

				return SliderFrame
			end

			return Section
		end

		return Tab
	end

	--// Dragging
	local dragging, dragInput, dragStart, startPos

	Main.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = Main.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)

	game:GetService("RunService").RenderStepped:Connect(function()
		if dragging and dragInput then
			local delta = dragInput.Position - dragStart
			Tween(Main, {
				Position = UDim2.new(
					startPos.X.Scale,
					startPos.X.Offset + delta.X,
					startPos.Y.Scale,
					startPos.Y.Offset + delta.Y
				)
			}, 0.15)
		end
	end)

	return Window
end

return MatrixUI
