local SharedEnvironment = {}
local cloneref = cloneref or function(x) return x end

local wax = {
    shared = setmetatable({}, {
        __index = SharedEnvironment,
        __newindex = function(_, index, value)
            SharedEnvironment[index] = value
        end,
    })
}

for _, Service in pairs({
    "ContentProvider",
    "CoreGui",
    "TweenService",
    "Players",
    "RunService",
    "HttpService",
    "UserInputService",
    "TextService",
    "StarterGui",
    "ReplicatedStorage",
    "TeleportService",
}) do
    wax.shared[Service] = cloneref(game:GetService(Service))
end

wax.shared.GPOVerificationToken = wax.shared.HttpService:GenerateGUID()
wax.shared.LocalPlayer = wax.shared.Players.LocalPlayer
wax.shared.Connections = {}

wax.shared.gethui = gethui or function()
    return wax.shared.CoreGui
end

wax.shared.checkcaller = checkcaller or function()
    return nil
end

wax.shared.getrawmetatable = getrawmetatable or debug.getmetatable
wax.shared.newcclosure = newcclosure or function(f) return f end

wax.shared.Connect = function(Connection)
    table.insert(wax.shared.Connections, Connection)
    return Connection
end

wax.shared.Disconnect = function(Connection)
    local Index = table.find(wax.shared.Connections, Connection)
    if Index then
        table.remove(wax.shared.Connections, Index)
    end
    pcall(function() Connection:Disconnect() end)
end

wax.shared.Unloaded = false
wax.shared.Unload = function()
    for _, Connection in pairs(wax.shared.Connections) do
        wax.shared.Disconnect(Connection)
    end

    if wax.shared.ActorCommunicator then
        wax.shared.ActorCommunicator:Fire("Unload")
    end

    wax.shared.Unloaded = true
end

wax.shared.FireRemote = function(remoteName, ...)
    if wax.shared.ActorCommunicator then
        wax.shared.ActorCommunicator:Fire("FireRemote", remoteName, ...)
    end
end

local ActorCode = [[]]
local ok, err = pcall(function()
if game.PlaceId == 1730877806 then
        -- Private Server Lobby
        for i,v in ipairs(game.CoreGui:GetChildren()) do
            if v.Name == "ScreenGui" and v.AbsoluteSize == Vector2.new(1920, 951) then
                v:Destroy()
            end
        end

        local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/s9mn2rcs4x-wq/RobloxLua/refs/heads/main/UI"))()

        local Window = Library.CreateMain({
            Title = "Xero - GPO",
            Desc = "Private Server Lobby",
            AntiAFK = true,
        })

        local Main = Library.CreateMain({Desc = "Xero Hub"})
        local MainPage = Main.CreatePage({Page_Name = "Main", Page_Title = "Main Features"})
        local MainSection = MainPage.CreateSection("Private Server", false, false)

        local PSCodeValue = ""

        MainSection.CreateBox({
            Title = "Private Server Code",
            Placeholder = "Enter PS Code"
        }, function(text)
            PSCodeValue = text
        end)

        MainSection.CreateToggle({
            Title = "Auto Join Private Server",
            Desc = "Automatically joins when game starts",
            Default = false
        }, function(enabled)
            if enabled then
                task.spawn(function()
                    local ok, err = pcall(function()
                        repeat task.wait()
                            game.ReplicatedStorage.Events.reserved:InvokeServer(PSCodeValue)
                            local choose = game.Players.LocalPlayer.PlayerGui:WaitForChild("chooseType")
                            game.Players.LocalPlayer.PlayerGui.chooseType.Frame.RemoteEvent:FireServer(true)
                        until not enabled
                    end)
                    if not ok then
                        warn("AutoJoinPS error:", err)
                    end
                end)
            end
        end)

        Library.CreateNoti({Title = "Loaded", Desc = "Xero loaded successfully for Private Server Lobby.", ShowTime = 5})

        local FrameTimer = tick()
        local FrameCounter = 0
        local FPS = 60

        local WatermarkConnection = game:GetService("RunService").RenderStepped:Connect(function()
            FrameCounter = FrameCounter + 1

            if (tick() - FrameTimer) >= 1 then
                FPS = FrameCounter
                FrameTimer = tick()
                FrameCounter = 0
            end

            local Stats;
            pcall(function()
                Stats = math.floor(game:FindService("Network").ServerStatsItem['Data Ping']:GetValue())
            end)
            -- Update watermark if method exists
            pcall(function()
                Library:SetWatermark(('Grand Piece Online | %s fps | %s ms'):format(
                    math.floor(FPS),
                    math.floor(Stats or 0)
                ))
            end)
        end)

elseif game.PlaceId == 3978370137 then
    -- Main Game
    ActorCode = [[
        local GPO_ACTOR_DATA = GPO_ACTOR_DATA_PLACEHOLDER
        local RelayChannel = get_comm_channel(GPO_ACTOR_DATA.Channel)

        for i,v in ipairs(game.CoreGui:GetChildren()) do
            if v.Name == "ScreenGui" and v.AbsoluteSize == Vector2.new(1920, 951) then
                v:Destroy()
            end
        end

        local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/s9mn2rcs4x-wq/RobloxLua/refs/heads/main/UI"))()

        local Window = Library.CreateMain({
            Title = "Xero - GPO",
            Desc = "Grand Piece Online",
            AntiAFK = true,
        })

        local Main = Library.CreateMain({Desc = "Main Hub"})
        
        -- Create Pages
        local MainPage = Main.CreatePage({Page_Name = "Farming", Page_Title = "Farming Features"})
        local TeleportsPage = Main.CreatePage({Page_Name = "Teleports", Page_Title = "Teleportation"})
        local MiscPage = Main.CreatePage({Page_Name = "Misc", Page_Title = "Miscellaneous"})
        local StatsPage = Main.CreatePage({Page_Name = "Stats", Page_Title = "Stats Management"})
        
        -- Create Sections
        local FarmsSection = MainPage.CreateSection("Farms", false, false)
        local FishSection = MainPage.CreateSection("Fishing", false, false)
        local LocationsSection = TeleportsPage.CreateSection("Locations", false, false)
        local TeleportSection = MiscPage.CreateSection("Teleportation", false, false)
        local CharacterSection = MiscPage.CreateSection("Character", false, false)
        local MerchantSection = MiscPage.CreateSection("Merchants", false, false)
        local StatsSection = StatsPage.CreateSection("Stats", false, false)

        -- Services
        local Players = cloneref(game:GetService("Players"))
        local LocalPlayer = cloneref(Players.LocalPlayer)
        local Character = LocalPlayer and cloneref(LocalPlayer.Character) or LocalPlayer.CharacterAdded:Wait()
        local ReplicatedStorage = cloneref(game:GetService("ReplicatedStorage"))
        local Events = cloneref(ReplicatedStorage:FindFirstChild("Events"))
        local Workspace = cloneref(game:GetService("Workspace"))
        local TweenService = cloneref(game:GetService("TweenService"))
        local RunService = cloneref(game:GetService("RunService"))
        local HttpService = cloneref(game:GetService("HttpService"))
        local TeleportService = cloneref(game:GetService("TeleportService"))
        local UserInputService = cloneref(game:GetService("UserInputService"))
        local Debris = cloneref(game:GetService("Debris"))
        local CoreGui = cloneref(game:GetService("CoreGui"))
        local Camera = Workspace.CurrentCamera;

        -- Variables
        local selectedWeapon = "Auto"
        local AutoLevelEnabled = false
        local InfiniteJumpEnabled = false
        local AutoRejoinEnabled = true

        local InputCallbacks
        task.spawn(function()
            pcall(function()
                local ScriptSet = ReplicatedStorage:FindFirstChild("Modules") and ReplicatedStorage.Modules:FindFirstChild("ScriptSet")
                if ScriptSet then
                    local ssPlayer = select(1, require(ScriptSet).get())
                    if ssPlayer and ssPlayer.Backpack then
                        local ic = ssPlayer.Backpack:FindFirstChild("InputCallbacks") or ssPlayer.Backpack:WaitForChild("InputCallbacks", 5)
                        if ic then
                            InputCallbacks = require(ic)
                        end
                    end
                end
            end)
        end)

        local StatsName, Stats
        local ok, err = pcall(function()
            StatsName = "Stats"..LocalPlayer.Name
            Stats = ReplicatedStorage:FindFirstChild(StatsName)
        end)

        local SavedSpawn = {
            ["Fishman Island"] = CFrame.new(7977.48145, -2152.83203, -17074.7422);
        }

        local Islands = {}

        if LocalPlayer.Backpack:FindFirstChild("SwimClientV2") then
            LocalPlayer.Backpack:FindFirstChild("SwimClientV2"):Destroy()
        end

        function getChar()
            local ok, err = pcall(function()
                if not LocalPlayer.Character then
                    local t0 = tick()
                    repeat task.wait()
                    until LocalPlayer.Character or (tick() - t0) > 2
                end
            end)
            if not ok then
                warn("getChar error:", err)
            end
            return LocalPlayer.Character
        end

        local function getHRP()
            local ok, err = pcall(function()
                if not getChar():FindFirstChild("HumanoidRootPart") then
                    repeat task.wait() until getChar():FindFirstChild("HumanoidRootPart")
                end
            end)
            if not ok then
                warn("HumanoidRootPart error:", err)
            end
            return getChar():FindFirstChild("HumanoidRootPart")
        end

        LocalPlayer.CharacterAdded:Connect(function(char)
            Character = char
        end)

        function getlvl()
            local levl = string.match(LocalPlayer.PlayerGui.HUD.Main.Bars.Experience.Detail.Level.Text, "%d+")
            return tonumber(levl)
        end

        local anchorPart, tween, rideConn
        local stopped = false

        local SPEED, SAFE_Y, FAR_DIST = 100, 4, 40

        local function ensureAnchor(cf)
            if anchorPart and anchorPart.Parent then
                anchorPart.CFrame = cf
                return anchorPart
            end
            local p = Instance.new("Part")
            p.Name = "TPAnchor"
            p.Size = Vector3.new(6,1,6)
            p.Anchored = true
            p.CanCollide = false
            p.Transparency = 1
            p.CFrame = cf
            p.Parent = workspace
            anchorPart = p
            return p
        end

        local function detach()
            if rideConn then rideConn:Disconnect() rideConn=nil end
        end

        function stop()
            stopped = true
            if tween then tween:Cancel() tween=nil end
            detach()
        end

        local function rideOn(a)
            detach()
            rideConn = RunService.Heartbeat:Connect(function()
                local hrp = getHRP()
                if not hrp or not a or not a.Parent then return end
                hrp.AssemblyLinearVelocity = Vector3.new(0,0,0)
                hrp.AssemblyAngularVelocity = Vector3.new(0,0,0)
                hrp.CFrame = a.CFrame * CFrame.new(0, (a.Size.Y + hrp.Size.Y) * 0.5, 0)
            end)
        end

        local function tweenTo(a, goalCf)
            local dist = (a.Position - goalCf.Position).Magnitude
            local time = dist / SPEED
            tween = TweenService:Create(a, TweenInfo.new(time, Enum.EasingStyle.Linear), {CFrame = goalCf})
            tween:Play()
            tween.Completed:Wait()
            tween = nil
        end

        function Goto(posOrCf)
            stopped = false
            local hrp = getHRP()
            if not hrp then return end

            local goal = (typeof(posOrCf) == "CFrame") and posOrCf or CFrame.new(posOrCf)
            local a = ensureAnchor(hrp.CFrame)
            rideOn(a)

            local dashActive = true
            task.spawn(function()
                local lastDash = 0
                while dashActive and not stopped do
                    local now = tick()
                    if now - lastDash >= 0.2 then
                        pcall(function()
                            if ReplicatedStorage
                                and ReplicatedStorage:FindFirstChild("Events")
                                and ReplicatedStorage.Events:FindFirstChild("takestam") then
                                ReplicatedStorage.Events.takestam:FireServer(0.53, "dash")
                            end
                        end)
                        lastDash = now
                    end
                    task.wait(0.05)
                end
            end)

            local startPos = a.Position
            local goalPos = goal.Position
            local rot = goal - goalPos

            local yDiff = math.abs(startPos.Y - goalPos.Y)
            local Y_CLOSE = 40

            local function snapBoth(cf)
                a.CFrame = cf
                hrp.CFrame = cf
            end

            if yDiff <= Y_CLOSE then
                tweenTo(a, goal)
                if stopped then dashActive = false return end

                snapBoth(goal)
                dashActive = false
                if not stopped then detach() end
                return
            end

            if math.abs(startPos.Y - SAFE_Y) > 2 then
                snapBoth(CFrame.new(startPos.X, SAFE_Y, startPos.Z) * rot)
                if stopped then dashActive = false return end
            end

            tweenTo(a, CFrame.new(goalPos.X, SAFE_Y, goalPos.Z) * rot)
            if stopped then dashActive = false return end

            snapBoth(goal)

            dashActive = false
            if not stopped then detach() end
        end

        local function HoldAt(posOrCf)
            stopped = false
            local hrp = getHRP()
            if not hrp then return end

            local goal = (typeof(posOrCf) == "CFrame") and posOrCf or CFrame.new(posOrCf)
            local a = ensureAnchor(goal)
            a.CFrame = goal
            rideOn(a)
        end

        function AttackGoto(posOrCf)
            stopped = false
            local hrp = getHRP()
            if not hrp then return end

            local goal = (typeof(posOrCf) == "CFrame") and posOrCf or CFrame.new(posOrCf)
            local a = ensureAnchor(hrp.CFrame)
            rideOn(a)

            local dashActive = true
            task.spawn(function()
                local lastDash = 0
                while dashActive and not stopped do
                    local now = tick()
                    if now - lastDash >= 0.2 then
                        pcall(function()
                            if ReplicatedStorage
                                and ReplicatedStorage:FindFirstChild("Events")
                                and ReplicatedStorage.Events:FindFirstChild("takestam") then
                                ReplicatedStorage.Events.takestam:FireServer(0.53, "dash")
                            end
                        end)
                        lastDash = now
                    end
                    task.wait(0.05)
                end
            end)

            local startPos = a.Position
            local goalPos = goal.Position
            local rot = goal - goalPos
            local snapDist = 6

            local yDiff = math.abs(startPos.Y - goalPos.Y)
            local Y_CLOSE = 100

            local function snapBoth(cf)
                a.CFrame = cf
                hrp.CFrame = cf
            end

            snapBoth(CFrame.new(startPos.X, goalPos.Y, startPos.Z) * rot)

            if (startPos - goalPos).Magnitude <= snapDist then
                snapBoth(goal)
                dashActive = false
                if not stopped then detach() end
                return
            end

            if yDiff <= Y_CLOSE then
                tweenTo(a, goal)
                if stopped then dashActive = false return end

                snapBoth(goal)
                dashActive = false
                if not stopped then detach() end
                return
            end

            if math.abs(startPos.Y - SAFE_Y) > 2 then
                snapBoth(CFrame.new(startPos.X, SAFE_Y, startPos.Z) * rot)
                if stopped then dashActive = false return end
            end

            tweenTo(a, CFrame.new(goalPos.X, SAFE_Y, goalPos.Z) * rot)
            if stopped then dashActive = false return end

            snapBoth(goal)

            dashActive = false
            if not stopped then detach() end
        end

        local function EquipGun()
            local char = getChar()
            local backpack = LocalPlayer:FindFirstChild("Backpack")
            if not char or not backpack then return false end

            for i, v in pairs(backpack:GetChildren()) do
                if v:IsA("Tool") and v.Name == "Rifle" then
                    LocalPlayer.Character.Humanoid:EquipTool(v)
                    return true
                end
            end
            return false
        end

        local function EquipMelee()
            local char = getChar()
            local backpack = LocalPlayer:FindFirstChild("Backpack")
            if not char or not backpack then return false end

            for _, v in pairs(backpack:GetChildren()) do
                if v:IsA("Tool") and (v:GetAttribute("MeleeTool") ~= nil) then
                    LocalPlayer.Character.Humanoid:EquipTool(v)
                    return true
                end
            end
            return false
        end

        -- Weapon Dropdown
        FarmsSection.CreateDropdown({
            Title = "Select Weapon",
            List = {'Auto', 'Melee', 'Rifle'},
            Default = "Auto"
        }, function(value)
            selectedWeapon = value
            if value == 'Rifle' then
                if not EquipGun() then
                    Library.CreateNoti({Title = "Error", Desc = "No gun found in backpack!", ShowTime = 3})
                end
            end
        end)

        local GunManager = Events.GunManager
        local gunFunctions = Events.GunManager.gunFunctions
        local GunHandle
        local function getGunHandle()
            if GunHandle then
                return GunHandle
            end
            return nil
        end

        local lastReloadTick = 0
        local RELOAD_COOLDOWN = 1.2
        local function tryReload()
            if tick() - lastReloadTick < RELOAD_COOLDOWN then
                return false
            end
            lastReloadTick = tick()
            local ok, res = pcall(function()
                return gunFunctions:InvokeServer("reload", { ["Gun"] = "Rifle" })
            end)
            return ok and res == true
        end

        local function FindGunObject()
            local char = getChar()
            if not char then return nil end

            local rifle = char:FindFirstChild("Rifle")
            if not rifle then return nil end

            local GH = getGunHandle()
            if GH and getupvalues and type(GH.New) == "function" then
                local ok, upvals = pcall(getupvalues, GH.New)
                if ok and type(upvals) == "table" then
                    for _, uv in pairs(upvals) do
                        if type(uv) == "table" then
                            for k, v in pairs(uv) do
                                if typeof(k) == "Instance" and type(v) == "table" then
                                    for _, obj in pairs(v) do
                                        if typeof(obj) == "table" and obj.Name == "Rifle" and obj.Tool == rifle then
                                            return obj
                                        end
                                    end
                                end
                                if typeof(v) == "table" and v.Name == "Rifle" and v.Tool == rifle then
                                    return v
                                end
                            end
                        end
                    end
                end
            end

            if GH and type(GH.New) == "function" then
                local ok, obj = pcall(GH.New, "Rifle", rifle)
                if ok then
                    return obj
                end
            end
            return nil
        end

        local LEAD_TIME = 0.12
        local TICK_STEP = 0.03

        local function resolveAimPosition(target)
            if typeof(target) == "Instance" then
                local pos = target.Position
                local v = target.AssemblyLinearVelocity
                if v.Magnitude > 120 then
                    v = v.Unit * 120
                end
                return pos + (v * LEAD_TIME)
            end
            return target
        end

        local function FireRifle(target)
            local ok, err = pcall(function()
                local char = getChar()
                if not char then return end

                local rifle = char:FindFirstChild("Rifle")
                if not rifle then
                    if not EquipGun() then
                        Library.CreateNoti({Title = "Error", Desc = "No gun found in backpack!", ShowTime = 3})
                        return
                    end
                    wait(1)
                    rifle = char:FindFirstChild("Rifle")
                end

                if not rifle then return end

                local Position = resolveAimPosition(target)
                if not Position then return end

                local gunObject = FindGunObject()

                _G.MouseCF = CFrame.new(resolveAimPosition(target))

                if gunObject then
                    if gunObject.Equiped == false then
                        gunObject.Equiped = true
                    end
                    if gunObject.Reloaded == false and gunObject.Reload then
                        gunObject:Reload()
                        local tReload = tick()
                        while gunObject.Reloaded == false and tick() - tReload < 3 do
                            RunService.RenderStepped:Wait()
                        end
                        if gunObject.Reloaded == false then
                            tryReload()
                        end
                    end
                    if gunObject.IsAiming == false then
                        gunObject:Aim()
                        local t0 = tick()
                        while gunObject.IsAiming == false and tick() - t0 < 1.5 do
                            RunService.RenderStepped:Wait()
                        end
                    end
                    gunObject:Fire()
                else
                    tryReload()
                    local startCFrame
                    local gunPart = char:FindFirstChild("RifleGun")
                    if gunPart and gunPart:FindFirstChild("Hole") then
                        startCFrame = gunPart.Hole.CFrame
                    else
                        local hrp = char:FindFirstChild("HumanoidRootPart")
                        if not hrp then return end
                        startCFrame = CFrame.new(hrp.Position, Position)
                    end
                    local currentPos = resolveAimPosition(target)
                    if not currentPos then return end

                    local gunData = {
                        ["Start"] = startCFrame,
                        ["Gun"] = "Rifle",
                        ["joe"] = "true",
                        ["Position"] = currentPos
                    }

                    task.spawn(newcclosure(function()
                        GunManager:FireServer("fire", gunData)
                    end))
                end

            end)

            if not ok then
                warn("FireRifle error:", err)
            end
        end

        local lastComboTick = 0
        local comboIndex = 1
        local COMBO_MAX = 5
        local COMBO_RESET = 3
        local lastMeleeTick = 0
        local MELEE_COOLDOWN = 0.24
        local MAX_TARGETS = 5
        local targetRot = 1

        local function doMeleeAttack(targetHrp)
            if not targetHrp then return end
            local now = tick()
            if now - lastMeleeTick < MELEE_COOLDOWN then return end
            lastMeleeTick = now

            if now - lastComboTick >= COMBO_RESET then
                comboIndex = 1
            end

            local anim = ReplicatedStorage.CombatAnimations.Melee:FindFirstChild("Punch"..comboIndex)
                or ReplicatedStorage.CombatAnimations.Melee:FindFirstChild("Punch1")

            local ok, err = pcall(function()
                local hrp = getHRP()
                if not hrp then return end

                local targets = {}
                local center = hrp.Position

                table.insert(targets, targetHrp)

                local function withinHorizontalRange(a, b, range)
                    local dx = a.X - b.X
                    local dz = a.Z - b.Z
                    return math.sqrt(dx*dx + dz*dz) <= range
                end

                for _, npc in pairs(workspace.NPCs:GetChildren()) do
                    if npc.Name == "Fishman Karate User" then
                        local nh = npc:FindFirstChild("Humanoid")
                        local nhrp = npc:FindFirstChild("HumanoidRootPart")
                        if nh and nh.Health > 0 and nhrp then
                            local dy = math.abs(nhrp.Position.Y - center.Y)
                            if dy <= 50 and withinHorizontalRange(nhrp.Position, center, 65) then
                                local already = false
                                for _, t in ipairs(targets) do
                                    if t == nhrp then
                                        already = true
                                        break
                                    end
                                end
                                if not already then
                                    table.insert(targets, nhrp)
                                end
                            end
                        end
                    end
                end

                if #targets == 0 then
                    targets = { targetHrp }
                end

                if #targets > MAX_TARGETS then
                    local subset = { targetHrp }
                    local others = {}
                    for _, t in ipairs(targets) do
                        if t ~= targetHrp then
                            table.insert(others, t)
                        end
                    end
                    if #others > 0 then
                        local start = targetRot
                        local count = math.min(MAX_TARGETS - 1, #others)
                        for i = 0, count - 1 do
                            local idx = ((start + i - 1) % #others) + 1
                            table.insert(subset, others[idx])
                        end
                        targetRot = (targetRot % #others) + 1
                    end
                    targets = subset
                end

                local swingTable = {
                    [1] = "swingsfx",
                    [2] = "Melee",
                    [3] = comboIndex,
                    [4] = "Ground",
                    [5] = false,
                    [6] = anim,
                    [7] = 2,
                    [8] = 1.5
                }
                Events.CombatRegister:InvokeServer(swingTable)

                local dmgTable = {
                    [1] = "damage",
                    [2] = targets,
                    [3] = "Melee",
                    [4] = { comboIndex, "Ground", "Melee" },
                    [5] = true,
                    [6] = hrp and hrp.CFrame or CFrame.new()
                }
                Events.CombatRegister:InvokeServer(dmgTable)

                for _,single in ipairs(targets) do
                    pcall(function()
                        Events.CombatRegister:InvokeServer({
                            "damage",
                            {single},
                            "Melee",
                            { comboIndex, "Ground", "Melee" },
                            true,
                            hrp.CFrame
                        })
                    end)
                end

                task.delay(0.05, function()
                    pcall(function()
                        Events.CombatRegister:InvokeServer(dmgTable)
                    end)
                end)
            end)

            if not ok then
                warn("Melee attack error:", err)
            end

            comboIndex = comboIndex + 1
            if comboIndex > COMBO_MAX then
                comboIndex = 1
                lastComboTick = now
            else
                lastComboTick = now
            end
        end

        local function getmob(mobname)
            local lowest, lowestHealth = nil, math.huge
            for i, v in pairs(workspace.NPCs:GetChildren()) do
                if v.Name == mobname and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 and v:FindFirstChild("HumanoidRootPart") then
                    if v.Humanoid.Health < lowestHealth then
                    lowest = v
                    lowestHealth = v.Humanoid.Health
                    end
                end
            end
            return lowest
        end

        local function getmobNotTargeting(mobname, hrp)
            local lowest, lowestHealth = nil, math.huge
            for _, v in pairs(workspace.NPCs:GetChildren()) do
                if v.Name == mobname and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 and v:FindFirstChild("HumanoidRootPart") then
                    local info = v:FindFirstChild("Info")
                    local targetValue = info and info:FindFirstChild("Target")
                    if not (targetValue and targetValue.Value == hrp) then
                        if v.Humanoid.Health < lowestHealth then
                            lowest = v
                            lowestHealth = v.Humanoid.Health
                        end
                    end
                end
            end
            return lowest
        end

        local function getmobNotTargetingNonBlocking(mobname, hrp)
            local lowest, lowestHealth = nil, math.huge
            for _, v in pairs(workspace.NPCs:GetChildren()) do
                if v.Name == mobname and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 and v:FindFirstChild("HumanoidRootPart") then
                    local info = v:FindFirstChild("Info")
                    local targetValue = info and info:FindFirstChild("Target")
                    if not (targetValue and targetValue.Value == hrp) and not v:FindFirstChild("Blocking") then
                        if v.Humanoid.Health < lowestHealth then
                            lowest = v
                            lowestHealth = v.Humanoid.Health
                        end
                    end
                end
            end
            return lowest
        end

        -- Auto Level Toggle
        FarmsSection.CreateToggle({
            Title = "Auto Level",
            Desc = "Automatically farm Levels",
            Default = false
        }, function(enabled)
            AutoLevelEnabled = enabled
            if enabled then
                task.spawn(function()
                    local ok, err = pcall(function()
                        repeat task.wait()
                            local SpawnPoint = Stats.SpawnPoints.FirstSea.Value
                            if SpawnPoint ~= "Fishman Island" then
                                Library.CreateNoti({Title = "Setting Spawn", Desc = "Going to Fishman Island...", ShowTime = 10})
                                repeat
                                    Goto(SavedSpawn["Fishman Island"])
                                    task.wait(1)
                                until (getHRP().Position - SavedSpawn["Fishman Island"].Position).Magnitude < 15 or not AutoLevelEnabled
                                stop()
                                if workspace.NPCs:FindFirstChild("Robo") then
                                    Events.SetSpawn:FireServer(nil, workspace.NPCs.Robo)
                                end;
                            elseif SpawnPoint == "Fishman Island" then

                                local char = getChar()
                                local Selection = selectedWeapon
                                local SafePosition = CFrame.new(7807.77295, -2157.83203, -17217.7832, 0.225631446, 4.29444e-08, 0.974212706, -1.13065335e-08, 1, -4.14624957e-08, -0.974212706, -1.65972602e-09, 0.225631446)
                                if Selection == "Rifle" then
                                    if not EquipGun() and not char:FindFirstChild("Rifle") then
                                        warn("No gun found in backpack!")
                                    else
                                        repeat task.wait()
                                            Goto(SafePosition)
                                        until (getHRP().Position - SafePosition.Position).Magnitude < 4 or not AutoLevelEnabled
                                        stop()

                                        if (getHRP().Position - SafePosition.Position).Magnitude < 4 then
                                            local mob = getmob("Fishman Karate User")
                                            local mhumanoid = mob and mob:FindFirstChild("Humanoid")
                                            if mob and (mhumanoid and mhumanoid.Health > 0) then
                                                warn("Found Mob! Shooting mob")
                                                local targetHighlight = Instance.new("Highlight")
                                                targetHighlight.Adornee = mob
                                                targetHighlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                                                targetHighlight.FillColor = Color3.fromRGB(255, 60, 60)
                                                targetHighlight.FillTransparency = 0.35
                                                targetHighlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                                                targetHighlight.OutlineTransparency = 0
                                                targetHighlight.Parent = mob
                                                repeat
                                                    task.wait(TICK_STEP)
                                                    local hrp = mob and mob:FindFirstChild("HumanoidRootPart")
                                                    if hrp then
                                                        FireRifle(hrp)
                                                    elseif mob and mob:FindFirstChild("Head") then
                                                        FireRifle(mob.Head)
                                                    end
                                                    mob = getmob("Fishman Karate User")
                                                    mhumanoid = mob and mob:FindFirstChild("Humanoid")
                                                    if targetHighlight then
                                                        if mob and mob.Parent then
                                                            targetHighlight.Adornee = mob
                                                            targetHighlight.Parent = mob
                                                        else
                                                            targetHighlight:Destroy()
                                                            targetHighlight = nil
                                                        end
                                                    end
                                                until not AutoLevelEnabled or not (mob and (mhumanoid and mhumanoid.Health > 0))
                                                if targetHighlight then
                                                    targetHighlight:Destroy()
                                                end
                                            end
                                        end
                                    end
                                end

                                if Selection == "Melee" then
                                    EquipMelee()
                                    local targetMeSpot = CFrame.new(7717.13525, -2168.60693, -17317.0059)
                                    local function allFishmanTargetMe()
                                        local hrp = getHRP()
                                        if not hrp then return false end
                                        local any = false
                                        for _, npc in pairs(workspace.NPCs:GetChildren()) do
                                            if npc.Name == "Fishman Karate User" then
                                                local hum = npc:FindFirstChild("Humanoid")
                                                if hum and hum.Health > 0 then
                                                    any = true
                                                    local info = npc:FindFirstChild("Info")
                                                    local targetValue = info and info:FindFirstChild("Target")
                                                    if not (targetValue and targetValue.Value == hrp) then
                                                        return false
                                                    end
                                                end
                                            end
                                        end
                                        return any
                                    end
                                    local function allFishmanBlocking()
                                        local any = false
                                        for _, npc in pairs(workspace.NPCs:GetChildren()) do
                                            if npc.Name == "Fishman Karate User" then
                                                local hum = npc:FindFirstChild("Humanoid")
                                                if hum and hum.Health > 0 then
                                                    any = true
                                                    if not npc:FindFirstChild("Blocking") then
                                                        return false
                                                    end
                                                end
                                            end
                                        end
                                        return any
                                    end

                                    local mob = getmob("Fishman Karate User")
                                    local mhumanoid = mob and mob:FindFirstChild("Humanoid")
                                    if mob and (mhumanoid and mhumanoid.Health > 0) then
                                        repeat
                                            task.wait(TICK_STEP)
                                            if not AutoLevelEnabled then
                                                stopAttack()
                                                break
                                            end
                                            local hrp = getHRP()
                                            local allTargeting = hrp and allFishmanTargetMe()
                                            local allBlocking = allFishmanBlocking()
                                            if allBlocking and hrp then
                                                HoldAt(targetMeSpot + Vector3.new(0,50,0))
                                                mob = nil
                                                mobHrp = nil
                                                continue
                                            end
                                            if allTargeting then
                                                HoldAt(targetMeSpot)
                                                mob = getmobNotTargetingNonBlocking("Fishman Karate User", hrp)
                                                    or getmobNotTargeting("Fishman Karate User", hrp)
                                                    or getmob("Fishman Karate User")
                                                mobHrp = mob and mob:FindFirstChild("HumanoidRootPart")
                                                if mobHrp then
                                                    doMeleeAttack(mobHrp)
                                                end
                                                continue
                                            end
                                            if hrp and (not mob or mob:FindFirstChild("Blocking") or not mhumanoid or mhumanoid.Health <= 0) then
                                                mob = getmobNotTargetingNonBlocking("Fishman Karate User", hrp)
                                                    or getmobNotTargeting("Fishman Karate User", hrp)
                                                    or getmob("Fishman Karate User")
                                                mhumanoid = mob and mob:FindFirstChild("Humanoid")
                                            end
                                            local mobHrp = mob and mob:FindFirstChild("HumanoidRootPart")
                                            local atSafeSpot = hrp and (hrp.Position - targetMeSpot.Position).Magnitude <= 6
                                            if hrp and mobHrp and not atSafeSpot then
                                                AttackGoto(CFrame.new(mobHrp.Position + Vector3.new(0, -12, 0)))
                                            end

                                            if mob and mob:FindFirstChild("Blocking") then
                                                mob = getmobNotTargetingNonBlocking("Fishman Karate User", hrp)
                                                    or getmobNotTargeting("Fishman Karate User", hrp)
                                                    or getmob("Fishman Karate User")
                                                mobHrp = mob and mob:FindFirstChild("HumanoidRootPart")
                                            end

                                            if mobHrp then
                                                doMeleeAttack(mobHrp)
                                            end

                                            if mob and hrp then
                                                local info = mob:FindFirstChild("Info")
                                                local targetValue = info and info:FindFirstChild("Target")
                                                if targetValue and targetValue.Value == hrp then
                                                    mob = getmobNotTargetingNonBlocking("Fishman Karate User", hrp)
                                                        or getmobNotTargeting("Fishman Karate User", hrp)
                                                        or getmob("Fishman Karate User")
                                                    mhumanoid = mob and mob:FindFirstChild("Humanoid")
                                                else
                                                    mob = getmob("Fishman Karate User")
                                                    mhumanoid = mob and mob:FindFirstChild("Humanoid")
                                                end
                                            else
                                                mob = getmob("Fishman Karate User")
                                                mhumanoid = mob and mob:FindFirstChild("Humanoid")
                                            end
                                            mhumanoid = mob and mob:FindFirstChild("Humanoid")
                                        until not AutoLevelEnabled or not (mob and (mhumanoid and mhumanoid.Health > 0))
                                    end
                                end
                            end;
                        until not AutoLevelEnabled
                    end)

                    if not ok then
                        warn("Auto Level error:", err)
                    end
                end)
            else
                stop()
            end
        end)

        FishSection.CreateToggle({
            Title = "Auto Fish",
            Desc = "Automatically fish for you",
            Default = false
        }, function(_)
            stop()
        end)

        -- Teleports
        local selectedLocation = "None"
        local IslandNames = {}

        local ok, err = pcall(function()
            for i, v in ipairs(ReplicatedStorage.CompassGuider:GetChildren()) do
                Islands[v.Name] = CFrame.new(v.Value)
                table.insert(IslandNames, v.Name)
            end
            table.sort(IslandNames)
            table.insert(IslandNames, 1, "None")
        end)

        if not ok then
            warn("Error fetching islands:", err)
        end

        LocationsSection.CreateDropdown({
            Title = "Select Location",
            List = IslandNames,
            Default = "None"
        }, function(value)
            selectedLocation = value
        end)

        local tpId = 0

        LocationsSection.CreateButton({Title = "Go To Island"}, function()
            local name = selectedLocation
            if not name or name == "None" or not Islands[name] then
                return Library.CreateNoti({Title = "Error", Desc = "Pick a valid location!", ShowTime = 3})
            end

            tpId += 1
            local id = tpId
            stop()
            stopped = false

            task.spawn(function()
                while id == tpId do
                    task.wait(0.1)
                    if stopped or selectedLocation ~= name then break end

                    local hrp = getHRP()
                    local char = getChar()
                    local hum = char and char:FindFirstChildOfClass("Humanoid")
                    if not hrp or not hum or hum.Health <= 0 then break end

                    local islandModel = workspace:FindFirstChild(name)
                    local sp = islandModel and islandModel:FindFirstChild("SpawnPoint")
                    local target = (sp and sp:IsA("BasePart")) and sp.CFrame or Islands[name]

                    Goto(target)

                    hrp = getHRP()
                    if not hrp then break end
                    if (target.Position - hrp.Position).Magnitude < 15 then break end
                end

                stop()
                if id == tpId and selectedLocation == name then
                    Library.CreateNoti({Title = "Teleport", Desc = "Arrived at " .. name, ShowTime = 3})
                end
            end)
        end)

        -- Misc - Teleportation
        TeleportSection.CreateButton({Title = "Rejoin"}, function()
            TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId)
        end)

        TeleportSection.CreateButton({Title = "Serverhop"}, function()
            local placeId = game.PlaceId
            local currentServerId = game.JobId
            local localPlayer = Players.LocalPlayer

            local CONFIG = {
                maxServersToCollect = 15,
                maxPagestoFetch = 5,
                preferLowPopulation = true,
                minPlayers = 1,
            }

            Library.CreateNoti({Title = "Serverhop", Desc = "Searching for servers...", ShowTime = 2})

            task.spawn(function()
                local success, err = pcall(function()
                    local servers = {}
                    local cursor = ""
                    local pagesFetched = 0

                    repeat
                        pagesFetched += 1
                        local url = string.format(
                            "https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=%s&limit=100%s",
                            placeId,
                            CONFIG.preferLowPopulation and "Asc" or "Desc",
                            cursor ~= "" and ("&cursor=" .. cursor) or ""
                        )

                        local response = request({
                            Url = url,
                            Method = "GET",
                            Headers = {
                                ["Content-Type"] = "application/json"
                            }
                        })

                        if not response or not response.Body then
                            error("Failed to fetch server list")
                        end

                        local data = HttpService:JSONDecode(response.Body)

                        if data and data.data then
                            for _, server in ipairs(data.data) do
                                local isValidServer = server.id ~= currentServerId
                                    and server.playing < server.maxPlayers
                                    and server.playing >= CONFIG.minPlayers

                                if isValidServer then
                                    table.insert(servers, {
                                        id = server.id,
                                        players = server.playing,
                                        maxPlayers = server.maxPlayers
                                    })
                                end
                            end
                        end

                        cursor = data and data.nextPageCursor or ""
                        task.wait(0.1)
                    until cursor == "" or #servers >= CONFIG.maxServersToCollect or pagesFetched >= CONFIG.maxPagestoFetch

                    if #servers == 0 then
                        Library.CreateNoti({Title = "Serverhop", Desc = "No available servers found.", ShowTime = 3})
                        return
                    end

                    table.sort(servers, function(a, b)
                        if CONFIG.preferLowPopulation then
                            return a.players < b.players
                        else
                            return a.players > b.players
                        end
                    end)

                    local poolSize = math.min(5, #servers)
                    local selectedServer = servers[math.random(1, poolSize)]

                    Library.CreateNoti({
                        Title = "Serverhop",
                        Desc = string.format("Joining server (%d/%d players)...", selectedServer.players, selectedServer.maxPlayers),
                        ShowTime = 2
                    })

                    task.wait(0.5)
                    TeleportService:TeleportToPlaceInstance(placeId, selectedServer.id, localPlayer)
                end)

                if not success then
                    Library.CreateNoti({Title = "Error", Desc = "Serverhop failed: " .. tostring(err), ShowTime = 4})
                end
            end)
        end)

        local autoRejoinConnection = nil
        local lastTeleportTime = 0

        TeleportSection.CreateToggle({
            Title = "Auto Rejoin on Kick",
            Desc = "Automatically rejoin if kicked",
            Default = true
        }, function(enabled)
            AutoRejoinEnabled = enabled
            if autoRejoinConnection then
                autoRejoinConnection:Disconnect()
                autoRejoinConnection = nil
            end

            if enabled then
                autoRejoinConnection = RunService.RenderStepped:Connect(function()
                    local promptOverlay = CoreGui:FindFirstChild("RobloxPromptGui")
                        and CoreGui.RobloxPromptGui:FindFirstChild("promptOverlay") and CoreGui.RobloxPromptGui.promptOverlay:FindFirstChild("ErrorPrompt")

                    if promptOverlay and promptOverlay.Visible then
                        local now = tick()
                        if now - lastTeleportTime > 3 then
                            lastTeleportTime = now
                            warn("Rejoining server...")
                            pcall(function()
                                TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, LocalPlayer)
                            end)
                        end
                    end
                end)
            end
        end)

        -- Misc - Character
        local infiniteJumpConn
        local lastJumpTick = 0
        local JUMP_COOLDOWN = 0.12
        local lastGroundJumpVelocity = 50

        CharacterSection.CreateToggle({
            Title = "Infinite Jump",
            Desc = "Jump infinitely in the air",
            Default = false
        }, function(enabled)
            InfiniteJumpEnabled = enabled
            if infiniteJumpConn then
                infiniteJumpConn:Disconnect()
                infiniteJumpConn = nil
            end

            if enabled then
                infiniteJumpConn = RunService.RenderStepped:Connect(function()
                    local ok, err = pcall(function()
                        local char = getChar()
                        local hrp = char and char:FindFirstChild("HumanoidRootPart")

                        if hrp then
                            local isSpaceDown = UserInputService:IsKeyDown(Enum.KeyCode.Space)
                            local humanoid = char:FindFirstChildOfClass("Humanoid")

                            if humanoid and humanoid.FloorMaterial ~= Enum.Material.Air then
                                if humanoid.UseJumpPower then
                                    lastGroundJumpVelocity = humanoid.JumpPower
                                else
                                    lastGroundJumpVelocity = math.sqrt(2 * workspace.Gravity * humanoid.JumpHeight)
                                end
                            end

                            if isSpaceDown and (tick() - lastJumpTick) >= JUMP_COOLDOWN then
                                if humanoid then
                                    local jumpVelocity = lastGroundJumpVelocity
                                    local vel = hrp.AssemblyLinearVelocity
                                    hrp.AssemblyLinearVelocity = Vector3.new(vel.X, jumpVelocity, vel.Z)
                                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                                end
                                lastJumpTick = tick()
                            end
                        end
                    end)

                    if not ok then
                        warn("InfiniteJump error:", err)
                    end
                end)
            else
                lastJumpTick = 0
            end
        end)

        local function FindClosestIslandToMerchant(MerchantPos)
            local closestIsland = nil
            local closestDistance = math.huge

            for islandName, islandCFrame in pairs(Islands) do
                local distance = (islandCFrame.Position - MerchantPos).Magnitude
                if distance < closestDistance then
                    closestDistance = distance
                    closestIsland = islandName
                end
            end

            return closestIsland
        end

        MerchantSection.CreateButton({Title = "Find Merchant"}, function()
            
            local ok, error = pcall(function()
                local TravelingMerchant = ReplicatedStorage:FindFirstChild("CompassGuider") and
                ReplicatedStorage.CompassGuider:FindFirstChild("Traveling Merchant") and 
                ReplicatedStorage.CompassGuider["Traveling Merchant"].Value

                if not TravelingMerchant then
                    return Library.CreateNoti({Title = "Error", Desc = "No traveling merchant found!", ShowTime = 5})
                end

                local closestIsland = FindClosestIslandToMerchant(TravelingMerchant)
                if not closestIsland then
                    return Library.CreateNoti({Title = "Error", Desc = "Could not determine closest island!", ShowTime = 5})
                end

                Library.CreateNoti({Title = "Traveling Merchant", Desc = "Closest island: " .. closestIsland, ShowTime = 5})
            end);


        end)

        -- Stats Section
        StatsSection.CreateToggle({
            Title = "Auto Strength",
            Desc = "Automatically upgrade Strength",
            Default = false,
            Box = {
                Placeholder = "Stop At",
                Default = "1",
                Number = true,
                Width = 90
            }
        }, function(enabled, stopValue)
            if enabled then
                task.spawn(function()
                    local targetValue = tonumber(stopValue) or 1
                    while enabled do
                        pcall(function()
                            game:GetService("ReplicatedStorage").Events.stats:FireServer("Strength", nil, 1)
                        end)
                        local statValue = Stats and Stats:FindFirstChild("Stats") and Stats.Stats:FindFirstChild("Strength")
                        if statValue and statValue.Value >= targetValue then
                            break
                        end
                        task.wait(0.1)
                    end
                end)
            end
        end)

        StatsSection.CreateToggle({
            Title = "Auto Stamina",
            Desc = "Automatically upgrade Stamina",
            Default = false,
            Box = {
                Placeholder = "Stop At",
                Default = "1",
                Number = true,
                Width = 90
            }
        }, function(enabled, stopValue)
            if enabled then
                task.spawn(function()
                    local targetValue = tonumber(stopValue) or 1
                    while enabled do
                        pcall(function()
                            game:GetService("ReplicatedStorage").Events.stats:FireServer("Stamina", nil, 1)
                        end)
                        local statValue = Stats and Stats:FindFirstChild("Stats") and Stats.Stats:FindFirstChild("Stamina")
                        if statValue and statValue.Value >= targetValue then
                            break
                        end
                        task.wait(0.1)
                    end
                end)
            end
        end)

        StatsSection.CreateToggle({
            Title = "Auto Defense",
            Desc = "Automatically upgrade Defense",
            Default = false,
            Box = {
                Placeholder = "Stop At",
                Default = "1",
                Number = true,
                Width = 90
            }
        }, function(enabled, stopValue)
            if enabled then
                task.spawn(function()
                    local targetValue = tonumber(stopValue) or 1
                    while enabled do
                        pcall(function()
                            game:GetService("ReplicatedStorage").Events.stats:FireServer("Defense", nil, 1)
                        end)
                        local statValue = Stats and Stats:FindFirstChild("Stats") and Stats.Stats:FindFirstChild("Defense")
                        if statValue and statValue.Value >= targetValue then
                            break
                        end
                        task.wait(0.1)
                    end
                end)
            end
        end)

        StatsSection.CreateToggle({
            Title = "Auto Gun Mastery",
            Desc = "Automatically upgrade Gun Mastery",
            Default = false,
            Box = {
                Placeholder = "Stop At",
                Default = "1",
                Number = true,
                Width = 90
            }
        }, function(enabled, stopValue)
            if enabled then
                task.spawn(function()
                    local targetValue = tonumber(stopValue) or 1
                    while enabled do
                        pcall(function()
                            game:GetService("ReplicatedStorage").Events.stats:FireServer("GunMastery", nil, 1)
                        end)
                        local statValue = Stats and Stats:FindFirstChild("Stats") and Stats.Stats:FindFirstChild("GunMastery")
                        if statValue and statValue.Value >= targetValue then
                            break
                        end
                        task.wait(0.1)
                    end
                end)
            end
        end)

        StatsSection.CreateToggle({
            Title = "Auto Sword Mastery",
            Desc = "Automatically upgrade Sword Mastery",
            Default = false,
            Box = {
                Placeholder = "Stop At",
                Default = "1",
                Number = true,
                Width = 90
            }
        }, function(enabled, stopValue)
            if enabled then
                task.spawn(function()
                    local targetValue = tonumber(stopValue) or 1
                    while enabled do
                        pcall(function()
                            game:GetService("ReplicatedStorage").Events.stats:FireServer("SwordMastery", nil, 1)
                        end)
                        local statValue = Stats and Stats:FindFirstChild("Stats") and Stats.Stats:FindFirstChild("SwordMastery")
                        if statValue and statValue.Value >= targetValue then
                            break
                        end
                        task.wait(0.1)
                    end
                end)
            end
        end)

        Library.CreateNoti({Title = "Loaded", Desc = "Xero loaded successfully.", ShowTime = 5})

        local FrameTimer = tick()
        local FrameCounter = 0
        local FPS = 60

        local WatermarkConnection = RunService.RenderStepped:Connect(function()
            FrameCounter = FrameCounter + 1

            if (tick() - FrameTimer) >= 1 then
                FPS = FrameCounter
                FrameTimer = tick()
                FrameCounter = 0
            end

            local Stats;
            pcall(function()
                Stats = math.floor(game:FindService("Network").ServerStatsItem['Data Ping']:GetValue())
            end)
            pcall(function()
                Library:SetWatermark(('Grand Piece Online | %s fps | %s ms'):format(
                    math.floor(FPS),
                    math.floor(Stats or 0)
                ))
            end)
        end)

        pcall(function()
            RelayChannel:Fire("ScriptLoaded")
        end)

        RelayChannel.Event:Connect(function(EventType, ...)
            if EventType == "Unload" then
                if WatermarkConnection then
                    WatermarkConnection:Disconnect()
                end
                if anchorPart then
                    anchorPart:Destroy()
                end
                print('Unloaded!')
            elseif EventType == "FireRemote" then
                local args = {...}
                local remote = args[1]
                table.remove(args, 1)

                local ok, err = pcall(function()
                    if remote and typeof(remote) == "Instance" then
                        if remote:IsA("RemoteEvent") then
                            remote:FireServer(unpack(args))
                        elseif remote:IsA("RemoteFunction") then
                            remote:InvokeServer(unpack(args))
                        end
                    else
                        warn("Invalid remote passed to FireRemote")
                    end
                end)
                if not ok then
                    warn("Error firing remote:", err)
                end
            end
        end)
    ]]
    local TargetActor = getactors and getactors()[1] or nil
    wax.shared.ActorsEnabled = (create_comm_channel and run_on_actor and TargetActor) ~= nil

    if wax.shared.ActorsEnabled then
        local CommunicationChannelID, Channel = create_comm_channel()
        wax.shared.ActorCommunicator = get_comm_channel(CommunicationChannelID)

        local ActorData
        if type(CommunicationChannelID) == "number" then
            ActorData = string.format("{Channel = %d}", CommunicationChannelID)
        else
            ActorData = string.format("{Channel = %q}", tostring(CommunicationChannelID))
        end

        wax.shared.Connect(Channel.Event:Connect(function(EventType, ...)
            if EventType == "ScriptLoaded" then
                print("Bypassed!")
            end
        end))

        local ok, err = pcall(function()
            local FinalActorCode = ActorCode:gsub("GPO_ACTOR_DATA_PLACEHOLDER", ActorData)
            run_on_actor(TargetActor, FinalActorCode)
        end)
        if not ok then
            warn("Error running on actor:", err)
        end
    else
        print("Actors not supported in this environment.")
    end
end
end)

if not ok then
    warn("Error in main script:", err)
end
